#!/bin/sh

# dependencies: maim, imagemagick, i3lock, dwmblocks

# take screenshot
maim /tmp/lockscreen.png

# blur it
convert /tmp/lockscreen.png -blur 0x4 /tmp/lockscreen.png

# disable notifications before locking
pkill -u "$USER" -USR1 dunst

# lock the screen with i3lock
i3lock -n -e -f -i /tmp/lockscreen.png

# enable notifications after unlocking
pkill -u "$USER" -USR2 dunst

# restart dwmblocks if it's running
# if it's not running, start it
# this is done to refresh the bar so it displays relevant information
pgrep -x dwmblocks > /dev/null && killall dwmblocks && setsid -f dwmblocks || setsid -f dwmblocks &
